var MongoRepository = require('mongorepository').Repository;
var _ = require('underscore'),
	routeRepository = new MongoRepository(process.env.DATA_STORE_CONNECTION_STRING,'routes');


var RouteStore = function(){
	
	var add = function(route,callback){
		route._id = route.routeName;
		routeRepository.add(route, function(){
			callback();
		});
		
	};			

	var all = function(callback){
		var query = {};
		routeRepository.find(query, callback);
	};

	var find = function(routeName, callback){
		var query = {"_id": routeName};
		routeRepository.find(query, function(results){
				callback(results[0]);
		});
	};

	var update = function(routeToUpdate,callback){
		var query = {"_id": routeToUpdate.routeName};
		routeToUpdate._id = routeToUpdate.routeName;
		routeRepository.update(query, routeToUpdate);	
	};
				
	return{
		add: add,
		find : find,
		update: update,
		all:all
	};
};


module.exports = RouteStore;