task :default => [:unit_tests, :git, :start_topcat]
NYAN_REPORTER = 'nyan'

task :ruby_dependencies do
	sh 'bundle install --path gems'
end

task :git => :ruby_dependencies do 
	require 'bundler/setup'
	require 'git_repository'
	message = ENV['m']
	raise 'no commit message specified' if message.nil?
	git = GitRepository.new
	git.pull
	git.add
	git.commit(message: message )
	git.push
	
end

task :unit_tests do
	sh "mocha ./tests/unit  --ui qunit --recursive --reporter nyan --timeout 15000"	
end

task :start_topcat => :ruby_dependencies do
	require 'bundler/setup'
	require 'httparty'
	HTTParty.post('https://circleci.com/api/v1/project/Allegro-Networks/topcat?circle-token=7105b1ec3a8b17b2de55c97984794a356943c01f')
end