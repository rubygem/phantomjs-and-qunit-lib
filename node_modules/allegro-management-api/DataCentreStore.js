var _ = require('underscore'),
	MongoRepository = require('mongorepository').Repository;	

var DataCentreStore = function(){
	var dataCentreRepository = new MongoRepository(process.env.DATA_STORE_CONNECTION_STRING,'data-centres'),
		dataCentreViewStoreRepository = new MongoRepository(process.env.VIEW_STORE_CONNECTION_STRING,'view-store-data-centres');
	
	function edit(oldDataCentre, newDataCentre, callback){
		var query = {name: oldDataCentre.name};
		dataCentreRepository.update(query, newDataCentre);
		dataCentreViewStoreRepository.update(query, newDataCentre);
		callback();
	}

	function remove(dataCentreName,callback){
		var query = {name: dataCentreName};

		dataCentreRepository.remove(query);
		dataCentreViewStoreRepository.remove(query);
		callback();
	}

	function findDataCentre(dataCentreName,callback){
		var query = {name: dataCentreName};
		dataCentreRepository.find(query, function(dataCentre){
			callback(dataCentre[0]);
		});
	}

	function allDataCentresViewModels(callback){
		var query = {};
		dataCentreViewStoreRepository.find(query, function(dataCentre){
			callback(dataCentre);
		});
	}

	function allDataCentres(callback){
		var query = {};
		dataCentreRepository.find(query, function(dataCentre){
			callback(dataCentre);
		});
	}

	return {
		remove:remove,
		edit:edit,
		findDataCentre: findDataCentre,
		allDataCentresViewModels:allDataCentresViewModels,
		allDataCentres:allDataCentres
	};
};

module.exports = DataCentreStore;